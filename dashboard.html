<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thrush Gains - Dashboard</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c;
            color: #e2e8f0;
            overflow-x: hidden;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* Light Theme */
        body.light-theme {
            background-color: #f0f4f8;
            color: #2d3748;
        }
        body.light-theme .header,
        body.light-theme .sidebar,
        body.light-theme .main-content-card,
        body.light-theme .modal-content,
        body.light-theme .dropdown-menu {
            background-color: #ffffff;
            color: #2d3748;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }
        body.light-theme .border-gray-700 {
            border-color: #e2e8f0;
        }
        body.light-theme .text-gray-400 {
            color: #718096;
        }
        body.light-theme .text-white {
            color: #2d3748;
        }
        body.light-theme .sidebar a,
        body.light-theme .sidebar button {
             color: #2d3748;
        }
        body.light-theme .sidebar a:hover,
        body.light-theme .sidebar button:hover {
            background-color: #edf2f7;
            color: #2d3748;
        }
        body.light-theme .hover\:bg-gray-700:hover {
            background-color: #edf2f7;
            color: #2d3748;
        }
        body.light-theme .modal-close-btn {
            background-color: #e2e8f0;
            color: #2d3748;
        }
        body.light-theme .modal-close-btn:hover {
            background-color: #cbd5e0;
        }
        body.light-theme .btn-gradient {
            background: linear-gradient(to right, #4A90E2, #50E3C2);
            color: white;
        }
        body.light-theme .form-input {
            background-color: #edf2f7;
            border-color: #cbd5e0;
            color: #2d3748;
        }
        body.light-theme .form-input:focus {
            border-color: #4A90E2;
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.5);
        }
        body.light-theme .text-green-500 {
            color: #28a745;
        }
        body.light-theme .text-yellow-400 {
            color: #ffc107;
        }
        body.light-theme .text-red-400 {
            color: #dc3545;
        }
        body.light-theme .text-blue-400 {
            color: #007bff;
        }
        body.light-theme .text-gray-200 {
            color: #4a5568;
        }
        body.light-theme .bg-gray-700 {
            background-color: #e2e8f0;
        }
        body.light-theme .bg-gray-800 {
            background-color: #f8faff;
        }

        /* Preloader styles */
        #preloader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #1a202c;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease-out, visibility 0.5s ease-out;
        }
        .preloader-hidden {
            opacity: 0 !important;
            visibility: hidden !important;
        }
        .preloader-icon {
            animation: spin 1.5s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Common Styling */
        .btn-gradient {
            background: linear-gradient(to right, #4A90E2, #50E3C2);
            transition: all 0.3s ease;
        }
        .btn-gradient:hover {
            box-shadow: 0 0 15px rgba(74, 144, 226, 0.6), 0 0 30px rgba(80, 227, 194, 0.4);
            transform: translateY(-2px);
        }
        .form-input {
            background-color: #2d3748;
            border: 1px solid #4a5568;
            color: #e2e8f0;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .form-input:focus {
            outline: none;
            border-color: #4A90E2;
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.5);
        }

        /* Dashboard Specific Styles */
        .header {
            background-color: #2d3748;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            z-index: 100;
            height: 4rem;
        }

        /* Improved Sidebar Responsiveness */
        .sidebar {
            background-color: #2d3748;
            transition: transform 0.3s ease-in-out;
            z-index: 90;
            overflow-y: auto;
            position: fixed;
            top: 0;
            left: 0;
            height: 100%;
            padding-top: 4rem;
        }

        /* Desktop sidebar */
        @media (min-width: 1024px) {
            .sidebar {
                transform: translateX(0%) !important;
                position: static;
                width: 16rem;
            }
            .mobile-sidebar-overlay {
                display: none !important;
            }
            .main-content {
                margin-left: 16rem;
            }
            .header {
                padding-left: 16rem;
            }
        }

        /* Tablet sidebar */
        @media (min-width: 768px) and (max-width: 1023px) {
            .sidebar {
                width: 14rem;
            }
            .sidebar-open {
                transform: translateX(0%);
            }
            .sidebar-closed {
                transform: translateX(-100%);
            }
            .main-content {
                margin-left: 0;
                transition: margin-left 0.3s ease;
            }
            .header {
                padding-left: 1rem;
            }
        }

        /* Mobile sidebar - much narrower */
        @media (max-width: 767px) {
            .sidebar {
                width: 70vw; /* 70% of viewport width */
                max-width: 250px; /* Maximum width */
                min-width: 200px; /* Minimum width */
            }
            .sidebar-open {
                transform: translateX(0%);
            }
            .sidebar-closed {
                transform: translateX(-100%);
            }
            .main-content {
                margin-left: 0;
            }
            .header {
                padding-left: 1rem;
                padding-right: 1rem;
            }
        }

        /* Extra small screens */
        @media (max-width: 480px) {
            .sidebar {
                width: 75vw;
                max-width: 220px;
                min-width: 180px;
            }
        }

        .main-content-card {
            background-color: #2d3748;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .dropdown-menu {
            background-color: #3a475a;
            border-radius: 0.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            z-index: 50;
            opacity: 0;
            transform: translateY(-10px);
            transition: opacity 0.2s ease-out, transform 0.2s ease-out;
            pointer-events: none;
        }
        .dropdown-menu.show {
            opacity: 1;
            transform: translateY(0);
            pointer-events: all;
        }
        .dropdown-item {
            padding: 0.5rem 1rem;
            cursor: pointer;
            transition: background-color 0.2s ease;
            white-space: nowrap;
        }
        .dropdown-item:hover {
            background-color: #4a5568;
        }
        .dropdown-item:first-child {
            border-top-left-radius: 0.5rem;
            border-top-right-radius: 0.5rem;
        }
        .dropdown-item:last-child {
            border-bottom-left-radius: 0.5rem;
            border-bottom-right-radius: 0.5rem;
        }

        /* Modal specific styles */
        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
        }
        .modal-content {
            background-color: #2d3748;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            animation: fadeInScaleUp 0.3s ease-out forwards;
            max-height: 90vh;
            overflow-y: auto;
        }
        @keyframes fadeInScaleUp {
            from { opacity: 0; transform: scale(0.9) translateY(20px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }
        .modal-close-btn {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s ease;
        }
        .modal-close-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Mobile sidebar overlay */
        .mobile-sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 80;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .mobile-sidebar-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        /* Hamburger menu animation */
        .hamburger {
            cursor: pointer;
            padding: 0.5rem;
            transition: all 0.3s ease;
        }
        .hamburger:hover {
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 0.25rem;
        }
        .hamburger.active .line1 {
            transform: rotate(-45deg) translate(-5px, 6px);
        }
        .hamburger.active .line2 {
            opacity: 0;
        }
        .hamburger.active .line3 {
            transform: rotate(45deg) translate(-5px, -6px);
        }
        .hamburger .line {
            width: 25px;
            height: 3px;
            background-color: white;
            margin: 3px 0;
            transition: 0.3s;
            border-radius: 2px;
        }

        /* TradingView widget container */
        #tradingview-widget-container {
            min-height: 300px;
            background-color: #1a202c;
            border-radius: 0.75rem;
            overflow: hidden;
        }

        /* Responsive text and elements */
        @media (max-width: 640px) {
            .text-responsive {
                font-size: 0.875rem;
            }
            .btn-responsive {
                padding: 0.5rem 0.75rem;
                font-size: 0.875rem;
            }
            .card-responsive {
                padding: 1rem;
            }
            .table-responsive {
                font-size: 0.75rem;
            }
            .modal-responsive {
                margin: 1rem;
                max-width: calc(100% - 2rem);
            }
        }

        /* Prevent horizontal scroll */
        * {
            box-sizing: border-box;
        }
        
        html, body {
            max-width: 100%;
            overflow-x: hidden;
        }

        /* Ensure content doesn't overflow on small screens */
        .container-fluid {
            width: 100%;
            max-width: 100%;
            padding-left: 1rem;
            padding-right: 1rem;
        }

        @media (max-width: 640px) {
            .container-fluid {
                padding-left: 0.5rem;
                padding-right: 0.5rem;
            }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Preloader -->
    <div id="preloader">
        <svg class="preloader-icon w-20 h-20 text-blue-500" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm.006 17.065c-2.704 0-4.475-1.574-4.636-3.837h2.06c.108.974.887 1.638 2.576 1.638 1.48 0 2.276-.645 2.276-1.517 0-.901-.635-1.378-2.316-2.127-1.928-.867-3.159-1.996-3.159-3.79 0-1.854 1.5-3.35 4.318-3.35 2.181 0 3.665.805 4.32 2.223h-2.03c-.225-.97-1.107-1.428-2.274-1.428-1.205 0-1.85.546-1.85 1.341 0 .809.522 1.157 1.935 1.77 2.056.885 3.197 2.18 3.197 3.906 0 2.074-1.63 3.522-4.57 3.522z"/>
        </svg>
        <p class="text-blue-400 text-lg mt-4">Loading Thrush Gains...</p>
    </div>

    <!-- Mobile Sidebar Overlay -->
    <div id="mobile-sidebar-overlay" class="mobile-sidebar-overlay"></div>

    <!-- Header -->
    <header class="header flex justify-between items-center p-4 sticky top-0 w-full">
        <div class="flex items-center">
            <!-- Mobile Hamburger Menu -->
            <button id="sidebar-toggle-btn" class="lg:hidden hamburger focus:outline-none mr-3">
                <div class="line line1"></div>
                <div class="line line2"></div>
                <div class="line line3"></div>
            </button>
            <h1 class="text-lg sm:text-xl lg:text-2xl font-bold text-white">Dashboard</h1>
        </div>
        <div class="flex items-center space-x-2 sm:space-x-4">
            <!-- User ID Display with Copy Icon -->
            <div class="flex items-center text-xs sm:text-sm mr-2 sm:mr-4 flex-shrink-0">
                <span class="text-gray-400 mr-1 sm:mr-2 hidden sm:inline">UID:</span>
                <span id="user-uid-display" class="text-white font-mono text-xs mr-1 truncate max-w-[60px] sm:max-w-[80px] lg:max-w-xs">N/A</span>
                <button id="copy-uid-btn" class="text-gray-400 hover:text-blue-400 focus:outline-none transition-colors duration-200" title="Copy User ID">
                    <svg class="w-3 h-3 sm:w-4 sm:h-4" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z"></path><path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z"></path></svg>
                </button>
            </div>
            <!-- Place Trade Button -->
            <button id="place-trade-btn" class="btn-gradient text-white px-3 py-2 sm:px-4 sm:py-2 rounded-lg font-semibold text-xs sm:text-sm hidden sm:flex items-center">
                <svg class="w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M10 2a8 8 0 100 16 8 8 0 000-16zM7 9a1 1 0 100-2 1 1 0 000 2zm2-1a1 100-2 1 1 0 012 0zm3 1a1 100-2 1 1 0 000 2zm-2 1a1 100-2 1 1 0 012 0zm3 1a1 100-2 1 1 0 000 2zm-2 1a1 100-2 1 1 0 012 0zm-3 1a1 100-2 1 1 0 000 2zm2 1a1 100-2 1 1 0 012 0z" clip-rule="evenodd"></path>
                </svg>
                <span class="hidden sm:inline">Place Trade</span>
                <span class="sm:hidden">Trade</span>
            </button>
            <!-- Exit/Logout Button -->
            <button id="logout-btn" class="text-white hover:text-red-400 transition-colors duration-200 focus:outline-none p-1">
                <svg class="w-5 h-5 sm:w-6 sm:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                </svg>
            </button>
        </div>
    </header>

    <!-- Main Layout -->
    <div class="flex flex-1">
        <!-- Sidebar -->
        <aside id="sidebar" class="sidebar sidebar-closed">
            <div class="flex items-center space-x-2 mb-6 px-4">
                <svg class="h-6 w-6 sm:h-8 sm:w-8 text-blue-400 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM7 9a1 1 0 100-2 1 1 0 000 2zm2-1a1 100-2 1 1 0 012 0zm3 1a1 100-2 1 1 0 000 2zm-2 1a1 100-2 1 1 0 012 0zm3 1a1 100-2 1 1 0 000 2zm-2 1a1 100-2 1 1 0 012 0zm-3 1a1 100-2 1 1 0 000 2zm2 1a1 100-2 1 1 0 012 0z" clip-rule="evenodd"></path>
                </svg>
                <span class="text-white text-sm sm:text-lg font-semibold truncate">Thrush Gains</span>
            </div>

            <nav class="space-y-1 px-2">
                <!-- Dashboard Link -->
                <a href="#" class="flex items-center p-2 rounded-lg text-white font-medium hover:bg-gray-700 transition duration-200 text-sm" id="dashboard-link">
                    <svg class="w-4 h-4 sm:w-5 sm:h-5 mr-2 sm:mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>
                    <span class="truncate">Dashboard</span>
                </a>

                <!-- Statement Dropdown -->
                <div class="relative">
                    <button id="statement-dropdown-toggle" class="flex items-center justify-between w-full p-2 rounded-lg text-white font-medium hover:bg-gray-700 transition duration-200 text-sm">
                        <span class="flex items-center min-w-0">
                            <svg class="w-4 h-4 sm:w-5 sm:h-5 mr-2 sm:mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 2v-6m2 8H7m6 2H7"></path></svg>
                            <span class="truncate">Statement</span>
                        </span>
                        <svg class="w-3 h-3 sm:w-4 sm:h-4 ml-2 transform transition-transform flex-shrink-0" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                    </button>
                    <div id="statement-dropdown-menu" class="dropdown-menu absolute left-0 mt-1 w-full rounded-md shadow-lg py-1 bg-gray-700">
                        <a href="#" class="dropdown-item flex items-center text-xs sm:text-sm text-gray-200 hover:text-white" data-modal-target="transaction-history-modal">
                            <svg class="w-3 h-3 sm:w-4 sm:h-4 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm-7-9a1 1 0 100-2 1 1 0 000 2zm2-1a1 100-2 1 1 0 012 0zm3 1a1 100-2 1 1 0 000 2zm-2 1a1 100-2 1 1 0 012 0zm3 1a1 100-2 1 1 0 000 2zm-2 1a1 100-2 1 1 0 012 0zm-3 1a1 100-2 1 1 0 000 2zm2 1a1 100-2 1 1 0 012 0z" clip-rule="evenodd"></path></svg>
                            <span class="truncate">Transaction History</span>
                        </a>
                        <a href="#" class="dropdown-item flex items-center text-xs sm:text-sm text-gray-200 hover:text-white" data-modal-target="trading-history-modal">
                            <svg class="w-3 h-3 sm:w-4 sm:h-4 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M9 17v-2m3 2v-4m3 2v-6m2 8H7m6 2H7" clip-rule="evenodd"></path></svg>
                            <span class="truncate">Trading History</span>
                        </a>
                    </div>
                </div>

                <!-- Account Dropdown -->
                <div class="relative">
                    <button id="account-dropdown-toggle" class="flex items-center justify-between w-full p-2 rounded-lg text-white font-medium hover:bg-gray-700 transition duration-200 text-sm">
                        <span class="flex items-center min-w-0">
                            <svg class="w-4 h-4 sm:w-5 sm:h-5 mr-2 sm:mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                            <span class="truncate">Account</span>
                        </span>
                        <svg class="w-3 h-3 sm:w-4 sm:h-4 ml-2 transform transition-transform flex-shrink-0" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                    </button>
                    <div id="account-dropdown-menu" class="dropdown-menu absolute left-0 mt-1 w-full rounded-md shadow-lg py-1 bg-gray-700">
                        <a href="#" class="dropdown-item flex items-center text-xs sm:text-sm text-gray-200 hover:text-white" data-modal-target="account-funding-modal">
                            <svg class="w-3 h-3 sm:w-4 sm:h-4 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 2a8 8 0 100 16 8 8 0 000-16zM7 9a1 100-2 1 1 0 000 2zm2-1a1 100-2 1 1 0 012 0zm3 1a1 100-2 1 1 0 000 2zm-2 1a1 100-2 1 1 0 012 0zm3 1a1 100-2 1 1 0 000 2zm-2 1a1 100-2 1 1 0 012 0zm-3 1a1 100-2 1 1 0 000 2zm2 1a1 100-2 1 1 0 012 0z" clip-rule="evenodd"></path></svg>
                            <span class="truncate">Account Funding</span>
                        </a>
                        <a href="#" class="dropdown-item flex items-center text-xs sm:text-sm text-gray-200 hover:text-white" data-modal-target="withdrawal-modal">
                            <svg class="w-3 h-3 sm:w-4 sm:h-4 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM7 9a1 100-2 1 1 0 000 2zm2-1a1 100-2 1 1 0 012 0zm3 1a1 100-2 1 1 0 000 2zm-2 1a1 100-2 1 1 0 012 0zm3 1a1 100-2 1 1 0 000 2zm-2 1a1 100-2 1 1 0 012 0zm-3 1a1 100-2 1 1 0 000 2zm2 1a1 100-2 1 1 0 012 0z" clip-rule="evenodd"></path></svg>
                            <span class="truncate">Withdrawal</span>
                        </a>
                        <a href="#" class="dropdown-item flex items-center text-xs sm:text-sm text-gray-200 hover:text-white" data-modal-target="transfer-modal">
                            <svg class="w-3 h-3 sm:w-4 sm:h-4 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM7 9a1 100-2 1 1 0 000 2zm2-1a1 100-2 1 1 0 012 0zm3 1a1 100-2 1 1 0 000 2zm-2 1a1 100-2 1 1 0 012 0zm3 1a1 100-2 1 1 0 000 2zm-2 1a1 100-2 1 1 0 012 0zm-3 1a1 100-2 1 1 0 000 2zm2 1a1 100-2 1 1 0 012 0z" clip-rule="evenodd"></path></svg>
                            <span class="truncate">Transfer Funds</span>
                        </a>
                    </div>
                </div>

                <!-- Settings Dropdown -->
                <div class="relative">
                    <button id="settings-dropdown-toggle" class="flex items-center justify-between w-full p-2 rounded-lg text-white font-medium hover:bg-gray-700 transition duration-200 text-sm">
                        <span class="flex items-center min-w-0">
                            <svg class="w-4 h-4 sm:w-5 sm:h-5 mr-2 sm:mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.827 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.827 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.827-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.827-3.31 2.37-2.37a1.724 1.724 0 002.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                            <span class="truncate">Settings</span>
                        </span>
                        <svg class="w-3 h-3 sm:w-4 sm:h-4 ml-2 transform transition-transform flex-shrink-0" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                    </button>
                    <div id="settings-dropdown-menu" class="dropdown-menu absolute left-0 mt-1 w-full rounded-md shadow-lg py-1 bg-gray-700">
                        <a href="#" class="dropdown-item flex items-center text-xs sm:text-sm text-gray-200 hover:text-white" data-modal-target="personal-data-modal">
                            <svg class="w-3 h-3 sm:w-4 sm:h-4 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"></path></svg>
                            <span class="truncate">Personal Data</span>
                        </a>
                        <a href="#" class="dropdown-item flex items-center text-xs sm:text-sm text-gray-200 hover:text-white" data-modal-target="theme-change-modal">
                            <svg class="w-3 h-3 sm:w-4 sm:h-4 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 2a1 100-1 1v1a1 100-2 0V3a1 100-1-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.458 4.908a1 100-1.454 1.134l-1.065-.851a.999.999 0 01-.116-.118 1 1 0 01-.002-1.414l.851-1.065a1 1 0 011.134-1.454l.118-.116z" clip-rule="evenodd"></path></svg>
                            <span class="truncate">Change Theme</span>
                        </a>
                    </div>
                </div>
            </nav>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content flex-1 container-fluid py-4 transition-all duration-300">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 lg:gap-6">
                <!-- TradingView Chart Widget (Left/Center) -->
                <div class="lg:col-span-2 main-content-card rounded-xl card-responsive">
                    <h2 class="text-lg sm:text-xl font-semibold mb-4 text-white">Market Overview</h2>
                    <div id="tradingview-widget-container" class="w-full h-64 sm:h-80 lg:h-96 flex items-center justify-center text-gray-500">
                        <!-- TradingView Widget BEGIN -->
                        <div class="tradingview-widget-container" style="height:100%; width:100%">
                            <div id="tradingview_f2345"></div>
                            <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-advanced-chart.js" async>
                            {
                                "autosize": true,
                                "symbol": "NASDAQ:AAPL",
                                "interval": "D",
                                "timezone": "Etc/UTC",
                                "theme": "dark",
                                "style": "1",
                                "locale": "en",
                                "enable_publishing": false,
                                "hide_top_toolbar": true,
                                "hide_legend": true,
                                "save_image": false,
                                "range": "1M",
                                "calendar": false,
                                "hide_volume": true,
                                "support_host": "https://www.tradingview.com"
                            }
                            </script>
                        </div>
                        <!-- TradingView Widget END -->
                    </div>
                </div>

                <!-- Account Summary/Quick Actions (Right) -->
                <div class="lg:col-span-1 main-content-card rounded-xl card-responsive flex flex-col justify-between">
                    <div>
                        <h2 class="text-lg sm:text-xl font-semibold mb-4 text-white">Your Account</h2>
                        <div class="space-y-3">
                            <div class="flex justify-between items-center py-2 border-b border-gray-700">
                                <span class="text-gray-400 text-sm">Balance:</span>
                                <span class="text-white font-bold text-sm sm:text-lg">$<span id="account-balance">10000.00</span></span>
                            </div>
                            <div class="flex justify-between items-center py-2 border-b border-gray-700">
                                <span class="text-gray-400 text-sm">P&L (24h):</span>
                                <span class="text-green-400 font-bold text-sm sm:text-lg">+$<span id="account-pnl">0.00</span></span>
                            </div>
                            <div class="flex justify-between items-center py-2 border-b border-gray-700">
                                <span class="text-gray-400 text-sm">Active Investments:</span>
                                <span class="text-white font-bold text-sm sm:text-lg" id="active-investments">0</span>
                            </div>
                        </div>
                    </div>
                    <!-- Place Trade Button for small screens -->
                    <button id="place-trade-btn-mobile" class="btn-gradient text-white px-6 py-3 rounded-lg font-semibold text-sm mt-6 sm:hidden flex items-center justify-center">
                        <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                            <path d="M10 2a8 8 0 100 16 8 8 0 000-16zM7 9a1 1 0 100-2 1 1 0 000 2zm2-1a1 100-2 1 1 0 012 0zm3 1a1 100-2 1 1 0 000 2zm-2 1a1 100-2 1 1 0 012 0zm3 1a1 100-2 1 1 0 000 2zm-2 1a1 100-2 1 1 0 012 0zm-3 1a1 100-2 1 1 0 000 2zm2 1a1 100-2 1 1 0 012 0z" clip-rule="evenodd"></path>
                        </svg>
                        Place Trade
                    </button>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="main-content-card rounded-xl card-responsive mt-4 lg:mt-6">
                <h2 class="text-lg sm:text-xl font-semibold mb-4 text-white">Recent Activity</h2>
                <ul id="recent-activity-list" class="space-y-3 text-xs sm:text-sm">
                    <li class="text-gray-400">Loading recent activity...</li>
                </ul>
            </div>
        </main>
    </div>

    <!-- All Modals (keeping all existing modals with responsive classes) -->
    
    <!-- Logout Confirmation Modal -->
    <div id="logout-confirm-modal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-70 hidden modal-overlay">
        <div class="modal-content p-4 sm:p-6 rounded-lg shadow-xl max-w-sm w-full text-center relative modal-responsive">
            <h3 class="text-lg sm:text-xl font-bold text-white mb-4">Confirm Logout</h3>
            <p class="text-gray-300 mb-6 text-sm sm:text-base">Are you sure you want to sign out?</p>
            <div class="flex justify-center space-x-4">
                <button id="confirm-logout-btn" class="btn-gradient text-white py-2 px-4 sm:px-6 rounded-lg font-semibold btn-responsive">Yes, Sign Out</button>
                <button id="cancel-logout-btn" class="bg-gray-600 text-white py-2 px-4 sm:px-6 rounded-lg font-semibold hover:bg-gray-700 transition btn-responsive">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Welcome Message Modal -->
    <div id="welcome-modal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-70 hidden modal-overlay">
        <div class="modal-content p-4 sm:p-6 rounded-lg shadow-xl max-w-sm w-full text-center relative modal-responsive">
            <button class="modal-close-btn absolute top-3 right-3" data-close-modal>
                <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
            <h3 class="text-lg sm:text-xl font-bold text-white mb-4">Welcome to Thrush Gains!</h3>
            <p class="text-gray-300 mb-6 text-sm sm:text-base">Explore your dashboard and start your journey with us.</p>
            <button id="welcome-modal-close-btn" class="btn-gradient text-white py-2 px-4 sm:px-6 rounded-lg font-semibold btn-responsive">Get Started</button>
        </div>
    </div>

    <!-- Personal Data Modal -->
    <div id="personal-data-modal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-70 hidden modal-overlay">
        <div class="modal-content p-4 sm:p-6 rounded-lg shadow-xl max-w-md w-full relative modal-responsive">
            <button class="modal-close-btn absolute top-3 right-3" data-close-modal>
                <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
            <h3 class="text-lg sm:text-2xl font-bold text-white mb-6 text-center">Personal Data</h3>
            <div id="personal-data-details" class="space-y-3 text-gray-300 text-sm">
                <p><strong>Full Name:</strong> <span id="data-full-name"></span></p>
                <p><strong>Username:</strong> <span id="data-username"></span></p>
                <p><strong>Email:</strong> <span id="data-email"></span></p>
                <p><strong>Date of Birth:</strong> <span id="data-dob"></span></p>
                <p><strong>Country:</strong> <span id="data-country"></span></p>
                <p><strong>City:</strong> <span id="data-city"></span></p>
                <p><strong>Workplace:</strong> <span id="data-workplace"></span></p>
                <p><strong>Transaction PIN:</strong> <span id="data-pin">****</span></p>
            </div>
        </div>
    </div>

    <!-- Theme Change Modal -->
    <div id="theme-change-modal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-70 hidden modal-overlay">
        <div class="modal-content p-4 sm:p-6 rounded-lg shadow-xl max-w-sm w-full relative modal-responsive">
            <button class="modal-close-btn absolute top-3 right-3" data-close-modal>
                <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
            <h3 class="text-lg sm:text-2xl font-bold text-white mb-6 text-center">Change Theme</h3>
            <div class="flex flex-col space-y-4">
                <button id="theme-dark" class="btn-gradient text-white py-3 px-6 rounded-lg font-semibold hover:opacity-90 transition btn-responsive">Dark Theme</button>
                <button id="theme-light" class="bg-gray-300 text-gray-800 py-3 px-6 rounded-lg font-semibold hover:bg-gray-400 transition btn-responsive">Light Theme</button>
            </div>
        </div>
    </div>

    <!-- Account Funding Modal -->
    <div id="account-funding-modal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-70 hidden modal-overlay">
        <div class="modal-content p-4 sm:p-6 rounded-lg shadow-xl max-w-md w-full relative modal-responsive">
            <button class="modal-close-btn absolute top-3 right-3" data-close-modal>
                <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
            <h3 class="text-lg sm:text-2xl font-bold text-white mb-6 text-center">Account Funding</h3>
            <p class="text-gray-300 mb-4 text-sm">Choose your preferred funding method:</p>
            <form id="funding-form" class="space-y-4">
                <div>
                    <label for="funding-amount" class="block text-sm font-medium text-gray-300 mb-1">Amount ($)</label>
                    <input type="number" id="funding-amount" min="10" required class="w-full form-input text-sm" placeholder="e.g., 500">
                </div>
                <div>
                    <label for="funding-method" class="block text-sm font-medium text-gray-300 mb-1">Method</label>
                    <select id="funding-method" class="w-full form-input text-sm">
                        <option value="">Select Method</option>
                        <option value="bitcoin">Bitcoin</option>
                        <option value="ethereum">Ethereum</option>
                        <option value="bank_transfer">Bank Transfer</option>
                        <option value="perfect_money">Perfect Money</option>
                    </select>
                </div>
                <button type="submit" class="w-full btn-gradient text-white py-2 px-4 rounded-lg font-semibold btn-responsive">Proceed to Fund</button>
            </form>
        </div>
    </div>

    <!-- Withdrawal Modal -->
    <div id="withdrawal-modal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-70 hidden modal-overlay">
        <div class="modal-content p-4 sm:p-6 rounded-lg shadow-xl max-w-md w-full relative modal-responsive">
            <button class="modal-close-btn absolute top-3 right-3" data-close-modal>
                <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
            <h3 class="text-lg sm:text-2xl font-bold text-white mb-6 text-center">Withdraw Funds</h3>
            <p class="text-gray-300 mb-4 text-sm">Enter withdrawal details:</p>
            <form id="withdrawal-form" class="space-y-4">
                <div>
                    <label for="withdrawal-amount" class="block text-sm font-medium text-gray-300 mb-1">Amount ($)</label>
                    <input type="number" id="withdrawal-amount" min="10" required class="w-full form-input text-sm" placeholder="e.g., 100">
                </div>
                <div>
                    <label for="withdrawal-method" class="block text-sm font-medium text-gray-300 mb-1">Method</label>
                    <select id="withdrawal-method" class="w-full form-input text-sm">
                        <option value="">Select Method</option>
                        <option value="bitcoin">Bitcoin Wallet</option>
                        <option value="bank_account">Bank Account</option>
                    </select>
                </div>
                <div>
                    <label for="withdrawal-address" class="block text-sm font-medium text-gray-300 mb-1">Wallet Address / Account No.</label>
                    <input type="text" id="withdrawal-address" required class="w-full form-input text-sm" placeholder="Your Bitcoin Address or Bank Account Number">
                </div>
                <button type="submit" class="w-full btn-gradient text-white py-2 px-4 rounded-lg font-semibold btn-responsive">Initiate Withdrawal</button>
            </form>
        </div>
    </div>

    <!-- Transfer Funds Modal -->
    <div id="transfer-modal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-70 hidden modal-overlay">
        <div class="modal-content p-4 sm:p-6 rounded-lg shadow-xl max-w-md w-full relative modal-responsive">
            <button class="modal-close-btn absolute top-3 right-3" data-close-modal>
                <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
            <h3 class="text-lg sm:text-2xl font-bold text-white mb-6 text-center">Transfer Funds</h3>
            <p class="text-gray-300 mb-4 text-sm">Send funds to another Thrush Gains user:</p>
            <form id="transfer-form" class="space-y-4">
                <div>
                    <label for="transfer-recipient-uid" class="block text-sm font-medium text-gray-300 mb-1">Recipient User ID</label>
                    <input type="text" id="transfer-recipient-uid" required class="w-full form-input text-sm" placeholder="Enter recipient's User ID">
                </div>
                <div>
                    <label for="transfer-amount" class="block text-sm font-medium text-gray-300 mb-1">Amount ($)</label>
                    <input type="number" id="transfer-amount" min="1" required class="w-full form-input text-sm" placeholder="e.g., 50">
                </div>
                <div>
                    <label for="transfer-pin" class="block text-sm font-medium text-gray-300 mb-1">Transaction PIN</label>
                    <input type="password" id="transfer-pin" required maxlength="4" pattern="\d{4}" class="w-full form-input text-sm" placeholder="****">
                </div>
                <button type="submit" class="w-full btn-gradient text-white py-2 px-4 rounded-lg font-semibold btn-responsive">Send Funds</button>
            </form>
        </div>
    </div>

    <!-- Transfer Confirmation Modal -->
    <div id="transfer-confirm-modal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-70 hidden modal-overlay">
        <div class="modal-content p-4 sm:p-6 rounded-lg shadow-xl max-w-sm w-full text-center relative modal-responsive">
            <h3 class="text-lg sm:text-xl font-bold text-white mb-4">Confirm Transfer</h3>
            <p class="text-gray-300 mb-6 text-sm" id="transfer-confirm-message"></p>
            <div class="flex justify-center space-x-4">
                <button id="transfer-confirm-proceed-btn" class="btn-gradient text-white py-2 px-4 sm:px-6 rounded-lg font-semibold btn-responsive">Proceed</button>
                <button id="transfer-confirm-cancel-btn" class="bg-gray-600 text-white py-2 px-4 sm:px-6 rounded-lg font-semibold hover:bg-gray-700 transition btn-responsive">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Transaction History Modal -->
    <div id="transaction-history-modal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-70 hidden modal-overlay">
        <div class="modal-content p-4 sm:p-6 rounded-lg shadow-xl max-w-4xl w-full relative modal-responsive">
            <button class="modal-close-btn absolute top-3 right-3" data-close-modal>
                <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
            <h3 class="text-lg sm:text-2xl font-bold text-white mb-6 text-center">Transaction History</h3>
            <div class="overflow-x-auto">
                <table class="min-w-full text-xs sm:text-sm text-left text-gray-400 table-responsive" id="transaction-history-table">
                    <thead class="text-xs text-gray-200 uppercase bg-gray-700">
                        <tr>
                            <th scope="col" class="py-2 sm:py-3 px-2 sm:px-3">Date</th>
                            <th scope="col" class="py-2 sm:py-3 px-2 sm:px-3">Type</th>
                            <th scope="col" class="py-2 sm:py-3 px-2 sm:px-3">Amount</th>
                            <th scope="col" class="py-2 sm:py-3 px-2 sm:px-3">Status</th>
                        </tr>
                    </thead>
                    <tbody id="transaction-history-table-body">
                        <tr class="bg-gray-800 border-b border-gray-700">
                            <td class="py-2 px-2 sm:px-3">2024-07-30</td>
                            <td class="py-2 px-2 sm:px-3">Deposit (BTC)</td>
                            <td class="py-2 px-2 sm:px-3 text-green-400">+$1,500.00</td>
                            <td class="py-2 px-2 sm:px-3 text-green-500">Completed</td>
                        </tr>
                        <tr class="bg-gray-800 border-b border-gray-700">
                            <td class="py-2 px-2 sm:px-3">2024-07-29</td>
                            <td class="py-2 px-2 sm:px-3">Withdrawal (Bank)</td>
                            <td class="py-2 px-2 sm:px-3 text-red-400">-$250.00</td>
                            <td class="py-2 px-2 sm:px-3 text-yellow-400">Pending</td>
                        </tr>
                        <tr class="bg-gray-800 border-b border-gray-700">
                            <td class="py-2 px-2 sm:px-3">2024-07-28</td>
                            <td class="py-2 px-2 sm:px-3">Referral Bonus</td>
                            <td class="py-2 px-2 sm:px-3 text-green-400">+$50.00</td>
                            <td class="py-2 px-2 sm:px-3 text-green-500">Completed</td>
                        </tr>
                        <tr class="bg-gray-800 border-b border-gray-700">
                            <td class="py-2 px-2 sm:px-3">2024-07-27</td>
                            <td class="py-2 px-2 sm:px-3">Transfer Out</td>
                            <td class="py-2 px-2 sm:px-3 text-red-400">-$100.00</td>
                            <td class="py-2 px-2 sm:px-3 text-green-500">Completed</td>
                        </tr>
                        <tr class="bg-gray-800 border-b border-gray-700">
                            <td class="py-2 px-2 sm:px-3">2024-07-26</td>
                            <td class="py-2 px-2 sm:px-3">Transfer In</td>
                            <td class="py-2 px-2 sm:px-3 text-green-400">+$75.00</td>
                            <td class="py-2 px-2 sm:px-3 text-green-500">Completed</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <p class="text-center text-gray-500 text-xs mt-4">For full history, please contact support.</p>
        </div>
    </div>

    <!-- Trading History Modal -->
    <div id="trading-history-modal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-70 hidden modal-overlay">
        <div class="modal-content p-4 sm:p-6 rounded-lg shadow-xl max-w-4xl w-full relative modal-responsive">
            <button class="modal-close-btn absolute top-3 right-3" data-close-modal>
                <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
            <h3 class="text-lg sm:text-2xl font-bold text-white mb-6 text-center">Trading History</h3>
            <div class="overflow-x-auto">
                <table class="min-w-full text-xs sm:text-sm text-left text-gray-400 table-responsive">
                    <thead class="text-xs text-gray-200 uppercase bg-gray-700">
                        <tr>
                            <th scope="col" class="py-2 sm:py-3 px-2 sm:px-3">Date</th>
                            <th scope="col" class="py-2 sm:py-3 px-2 sm:px-3">Asset</th>
                            <th scope="col" class="py-2 sm:py-3 px-2 sm:px-3">Type</th>
                            <th scope="col" class="py-2 sm:py-3 px-2 sm:px-3">Amount</th>
                            <th scope="col" class="py-2 sm:py-3 px-2 sm:px-3">Result</th>
                        </tr>
                    </thead>
                    <tbody id="trading-history-table-body">
                        <tr class="bg-gray-800 border-b border-gray-700">
                            <td class="py-2 px-2 sm:px-3">2024-07-30</td>
                            <td class="py-2 px-2 sm:px-3">BTC/USD</td>
                            <td class="py-2 px-2 sm:px-3 text-blue-400">Buy</td>
                            <td class="py-2 px-2 sm:px-3">$500.00</td>
                            <td class="py-2 px-2 sm:px-3 text-green-400">+$25.00</td>
                        </tr>
                        <tr class="bg-gray-800 border-b border-gray-700">
                            <td class="py-2 px-2 sm:px-3">2024-07-29</td>
                            <td class="py-2 px-2 sm:px-3">ETH/USD</td>
                            <td class="py-2 px-2 sm:px-3 text-red-400">Sell</td>
                            <td class="py-2 px-2 sm:px-3">$300.00</td>
                            <td class="py-2 px-2 sm:px-3 text-red-400">-$15.00</td>
                        </tr>
                        <tr class="bg-gray-800 border-b border-gray-700">
                            <td class="py-2 px-2 sm:px-3">2024-07-28</td>
                            <td class="py-2 px-2 sm:px-3">AAPL</td>
                            <td class="py-2 px-2 sm:px-3 text-blue-400">Buy</td>
                            <td class="py-2 px-2 sm:px-3">$1000.00</td>
                            <td class="py-2 px-2 sm:px-3 text-green-400">+$70.00</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <p class="text-center text-gray-500 text-xs mt-4">For detailed trade logs, refer to your trading platform.</p>
        </div>
    </div>

    <!-- Custom Message Modal -->
    <div id="message-modal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-70 hidden modal-overlay">
        <div class="modal-content p-4 sm:p-6 rounded-lg shadow-xl max-w-sm w-full text-center relative modal-responsive">
            <h3 class="text-lg sm:text-xl font-bold text-white mb-4" id="message-modal-title"></h3>
            <p class="text-gray-300 mb-6 text-sm" id="message-modal-text"></p>
            <button id="message-modal-close-btn" class="btn-gradient text-white py-2 px-4 sm:px-6 rounded-lg font-semibold btn-responsive">OK</button>
        </div>
    </div>

<!-- Firebase SDKs -->
<script type="module">
    // Firebase CDN Imports
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getDatabase, ref, get, child, push, set, onValue, off, update } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-database.js";

    // Your Firebase Configuration
    const firebaseConfig = {
        apiKey: "AIzaSyAg4uAaMhUsZaA3bTfRuHy7kNfnalYzE-o",
        authDomain: "thrushgains.firebaseapp.com",
        projectId: "thrushgains",
        databaseURL: "https://thrushgains-default-rtdb.firebaseio.com", // Make sure this is correct for RTDB
        storageBucket: "thrushgains.firebasestorage.app",
        messagingSenderId: "859074169386",
        appId: "1:859074169386:web:55d1fd673abe58e0405153",
        measurementId: "G-4HQKL3MLLE"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);
    const appId = firebaseConfig.projectId; // Use projectId as appId for RTDB path

    let currentUser = null; // Store the current authenticated user
    let transactionListener = null; // Store transaction listener reference
    let balanceListener = null; // Store balance listener reference
    let userProfileListener = null; // Store user profile listener reference


    // Declare UI elements globally, but assign them inside DOMContentLoaded
    let preloader, sidebarToggleBtn, sidebar, mobileSidebarOverlay, logoutBtn, logoutConfirmModal, confirmLogoutBtn, cancelLogoutBtn, placeTradeBtn, placeTradeBtnMobile;
    let statementDropdownToggle, statementDropdownMenu, accountDropdownToggle, accountDropdownMenu, settingsDropdownToggle, settingsDropdownMenu;
    let welcomeModal, welcomeModalCloseBtn, personalDataModal, themeChangeModal, accountFundingModal, withdrawalModal, transferModal, transactionHistoryModal, tradingHistoryModal, transferConfirmModal;
    let dataFullName, dataUsername, dataEmail, dataDob, dataCountry, dataCity, dataWorkplace, dataPin;
    let themeDarkBtn, themeLightBtn;
    let userUidDisplay, copyUidBtn;
    let fundingForm, withdrawalForm, transferForm;
    let transferRecipientUidInput, transferAmountInput, transferPinInput;
    let transferConfirmMessage, transferConfirmProceedBtn, transferConfirmCancelBtn;
    let recentActivityList, transactionHistoryTableBody;
    let messageModal, messageModalTitle, messageModalText, messageModalCloseBtn;
    let accountBalanceDisplay;
    let blockedUserModal; // Add this for blocked user modal


    // --- Utility Functions ---

    // Function to show a modal
    function showModal(modalElement) {
        if (modalElement) {
            modalElement.classList.remove('hidden');
            console.log(`Modal Shown: ${modalElement.id}`);
        } else {
            console.error("Attempted to show a null modalElement!");
        }
    }

    // Function to hide a modal
    function hideModal(modalElement) {
        if (modalElement) {
            modalElement.classList.add('hidden');
            console.log(`Modal Hidden: ${modalElement.id}`);
        } else {
            console.error("Attempted to hide a null modalElement!");
        }
    }

    // Function to toggle dropdown menu visibility
    function toggleDropdown(toggleButton, menuElement) {
        // Close other dropdowns first
        [statementDropdownMenu, accountDropdownMenu, settingsDropdownMenu].forEach(menu => {
            if (menu && menu !== menuElement && menu.classList.contains('show')) {
                menu.classList.remove('show');
                const prevSibling = menu.previousElementSibling;
                if (prevSibling) {
                    const arrowIcon = prevSibling.querySelector('svg:last-child');
                    if (arrowIcon) {
                        arrowIcon.classList.remove('rotate-180');
                    }
                }
            }
        });

        if (menuElement && toggleButton) {
            menuElement.classList.toggle('show');
            const arrowIcon = toggleButton.querySelector('svg:last-child');
            if (arrowIcon) {
                if (menuElement.classList.contains('show')) {
                    arrowIcon.classList.add('rotate-180');
                } else {
                    arrowIcon.classList.remove('rotate-180');
                }
            }
        } else {
             console.error("Attempted to toggle dropdown with null elements:", { toggleButton, menuElement });
        }
    }

    // Function to show custom message box (modal)
    function showMessageBox(title, message) {
        // Ensure elements are available before attempting to set properties
        if (messageModalTitle && messageModalText && messageModal) {
            messageModalTitle.textContent = title;
            messageModalText.textContent = message;
            messageModal.classList.remove('hidden');
            console.log(`Message Box Displayed: Title - "${title}", Message - "${message}"`);
        } else {
            console.error("MessageBox elements not found! Cannot display message:", { title, message });
            // Fallback for critical issues, though should ideally not be needed now
            // alert(`${title}\n${message}`);
        }
    }

    // Function to hide custom message box
    function hideMessageBox() {
        if (messageModal) {
            messageModal.classList.add('hidden');
            console.log("Message Box Hidden.");
        } else {
            console.error("Attempted to hide a null messageModal!");
        }
    }

    // Function to apply saved theme preference
    function applySavedTheme() {
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'light') {
            document.body.classList.add('light-theme');
            console.log("Applied Light Theme.");
        } else {
            document.body.classList.remove('light-theme'); // Default to dark if no preference or 'dark'
            console.log("Applied Dark Theme (or default).");
        }
    }

    // Function to check if user is blocked
    async function checkUserBlockStatus() {
        try {
            const userProfileRef = ref(db, `artifacts/${appId}/users/${currentUser.uid}/profile`);
            const snapshot = await get(userProfileRef);
            
            if (snapshot.exists()) {
                const userData = snapshot.val();
                if (userData.isBlocked === true) {
                    // User is blocked, show message and prevent access
                    showBlockedUserInterface();
                    return true;
                }
            }
            return false;
        } catch (error) {
            console.error("Error checking user block status:", error);
            return false;
        }
    }

    // Function to show blocked user interface
    function showBlockedUserInterface() {
        // Hide all dashboard content
        const dashboardContent = document.querySelector('.dashboard-content') || document.body;
        if (dashboardContent) {
            dashboardContent.style.display = 'none';
        }

        // Create or show blocked user modal/message
        let blockedModal = document.getElementById('blocked-user-modal');
        if (!blockedModal) {
            // Create the blocked user modal if it doesn't exist
            blockedModal = document.createElement('div');
            blockedModal.id = 'blocked-user-modal';
            blockedModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            blockedModal.innerHTML = `
                <div class="bg-gray-800 p-8 rounded-lg shadow-lg max-w-md mx-4 text-center">
                    <div class="text-red-400 text-6xl mb-4">⚠️</div>
                    <h2 class="text-2xl font-bold text-white mb-4">Account Blocked</h2>
                    <p class="text-gray-300 mb-6">
                        Your account has been temporarily blocked. 
                        Please contact our customer support team for assistance.
                    </p>
                    <button id="contact-support-btn" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded mr-4">
                        Contact Support
                    </button>
                    <button id="blocked-logout-btn" class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-2 rounded">
                        Logout
                    </button>
                </div>
            `;
            document.body.appendChild(blockedModal);

            // Add event listeners to the new buttons
            document.getElementById('contact-support-btn').addEventListener('click', () => {
                showMessageBox("Contact Support", "Please use the chat feature or email support@thrushgains.com for assistance.");
            });

            document.getElementById('blocked-logout-btn').addEventListener('click', async () => {
                try {
                    await signOut(auth);
                } catch (error) {
                    console.error("Logout failed:", error);
                }
            });
        } else {
            blockedModal.classList.remove('hidden');
        }
    }

    // --- Firebase Transaction Functions ---

    // Function to save transaction to Firebase (using admin dashboard compatible path)
    async function saveTransactionToFirebase(transactionData) {
        try {
            // Save to public transactions path (for admin dashboard compatibility)
            const publicTransactionRef = ref(db, `artifacts/${appId}/public/data/transactions`);
            const newPublicTransactionRef = push(publicTransactionRef);
            await set(newPublicTransactionRef, {
                id: newPublicTransactionRef.key,
                userId: currentUser.uid,
                type: transactionData.type === 'deposit' ? 'Deposit' : 
                      transactionData.type === 'withdrawal' ? 'Withdrawal' :
                      transactionData.type === 'transfer_out' ? 'Transfer Out' :
                      transactionData.type === 'transfer_in' ? 'Transfer In' : 'Deposit',
                method: transactionData.method || 'N/A',
                amount: transactionData.amount,
                address: transactionData.address || '',
                recipientUid: transactionData.recipientUid || '',
                senderUid: transactionData.senderUid || '',
                description: transactionData.description,
                date: new Date().toISOString().slice(0, 10),
                status: 'Pending',
                createdAt: Date.now(),
                updatedAt: Date.now()
            });

            console.log("Transaction saved to Firebase:", newPublicTransactionRef.key);
            return newPublicTransactionRef.key;
        } catch (error) {
            console.error("Error saving transaction to Firebase:", error);
            throw error;
        }
    }

    // Function to load user balance from Firebase (using admin dashboard compatible path)
    async function loadUserBalance() {
        try {
            const balanceRef = ref(db, `artifacts/${appId}/users/${currentUser.uid}/profile/accountBalance`); // Using profile/accountBalance for consistency
            const snapshot = await get(balanceRef);
            const balance = snapshot.exists() ? snapshot.val() : 0;
            if (accountBalanceDisplay) {
                accountBalanceDisplay.textContent = parseFloat(balance).toFixed(2);
            }
            console.log("User balance loaded:", balance);
            return parseFloat(balance);
        } catch (error) {
            console.error("Error loading user balance:", error);
            return 0;
        }
    }

    // Function to update user balance in Firebase (not needed for user dashboard, admin handles this approval)
    // Removed direct update of balance by user here. It will be updated by admin via transactions.
    // async function updateUserBalance(newBalance) { ... } // No longer needed here


    // Function to load and display transactions from Firebase
    async function loadTransactionsFromFirebase() {
        try {
            // Load from public transactions path where admin manages them
            const transactionRef = ref(db, `artifacts/${appId}/public/data/transactions`);
            const snapshot = await get(transactionRef);
            
            if (snapshot.exists()) {
                const transactions = snapshot.val();
                const userTransactions = [];
                
                // Filter transactions for current user
                Object.values(transactions).forEach(transaction => {
                    if (transaction.userId === currentUser.uid || 
                        transaction.senderUid === currentUser.uid || 
                        transaction.recipientUid === currentUser.uid) {
                        userTransactions.push(transaction);
                    }
                });
                
                // Sort by creation date (newest first)
                userTransactions.sort((a, b) => (b.createdAt || 0) - (a.createdAt || 0));
                
                // Clear existing UI
                if (recentActivityList) recentActivityList.innerHTML = '';
                if (transactionHistoryTableBody) transactionHistoryTableBody.innerHTML = '';
                
                // Display transactions
                userTransactions.forEach(transaction => {
                    displayTransactionInUI(transaction);
                });
                
                console.log("Transactions loaded from Firebase:", userTransactions.length);
            } else {
                console.log("No transactions found for user");
            }
        } catch (error) {
            console.error("Error loading transactions from Firebase:", error);
        }
    }

    // Function to display transaction in Recent Activity only
    function displayTransactionInRecentActivity(transaction) {
        const date = transaction.date || new Date(transaction.createdAt || Date.now()).toISOString().slice(0, 10);
        
        // Add to Recent Activity only
        if (recentActivityList) {
            const newItem = document.createElement('li');
            newItem.className = "flex justify-between items-center pb-2 border-b border-gray-700";
            newItem.setAttribute('data-transaction-id', transaction.id || transaction.transactionId);
            
            let activityText = '';
            let amountColor = '';
            let statusColor = '';
            
            // Handle transaction types from admin dashboard format
            switch (transaction.type) {
                case 'Deposit':
                    activityText = `Funding: +${parseFloat(transaction.amount).toFixed(2)} <span class="text-gray-400 text-xs"> (${transaction.method})</span>`;
                    amountColor = 'text-green-400';
                    break;
                case 'Withdrawal':
                    activityText = `Withdrawal: -${parseFloat(transaction.amount).toFixed(2)} <span class="text-gray-400 text-xs"> (${transaction.method})</span>`;
                    amountColor = 'text-red-400';
                    break;
                case 'Transfer Out':
                    activityText = `Transfer: -${parseFloat(transaction.amount).toFixed(2)} <span class="text-gray-400 text-xs"> (To ${(transaction.recipientUid || '').substring(0, 8)}...)</span>`;
                    amountColor = 'text-red-400';
                    break;
                case 'Transfer In':
                    activityText = `Received: +${parseFloat(transaction.amount).toFixed(2)} <span class="text-gray-400 text-xs"> (From ${(transaction.senderUid || '').substring(0, 8)}...)</span>`;
                    amountColor = 'text-green-400';
                    break;
                default:
                    activityText = `${transaction.type}: ${parseFloat(transaction.amount).toFixed(2)}`;
                    amountColor = 'text-blue-400';
                    break;
            }
            
            // Handle status from admin dashboard format
            const status = transaction.status.toLowerCase();
            switch (status) {
                case 'pending':
                    statusColor = 'text-yellow-400';
                    break;
                case 'completed':
                case 'approved': // Handle 'Approved' from admin as 'Completed' on user side
                    statusColor = 'text-green-400';
                    break;
                case 'declined':
                    statusColor = 'text-red-400';
                    break;
                default:
                    statusColor = 'text-gray-400';
                    break;
            }
            
            newItem.innerHTML = `
                <span>${activityText}</span>
                <span class="${statusColor}">${transaction.status}</span>
            `;
            recentActivityList.appendChild(newItem);
        }
    }

    // Function to display transaction in Transaction History Table only
    function displayTransactionInTable(transaction) {
        const date = transaction.date || new Date(transaction.createdAt || Date.now()).toISOString().slice(0, 10);
        
        // Add to Transaction History only
        if (transactionHistoryTableBody) {
            const newRow = document.createElement('tr');
            newRow.className = "bg-gray-800 border-b border-gray-700";
            newRow.setAttribute('data-transaction-id', transaction.id || transaction.transactionId);
            
            let transactionTypeText = '';
            let amountText = '';
            let amountColor = '';
            let statusColor = '';
            
            switch (transaction.type) {
                case 'Deposit':
                    transactionTypeText = `Deposit (${transaction.method})`;
                    amountText = `+${parseFloat(transaction.amount).toFixed(2)}`;
                    amountColor = 'text-green-400';
                    break;
                case 'Withdrawal':
                    transactionTypeText = `Withdrawal (${transaction.method})`;
                    amountText = `-${parseFloat(transaction.amount).toFixed(2)}`;
                    amountColor = 'text-red-400';
                    break;
                case 'Transfer Out':
                    transactionTypeText = 'Transfer Out';
                    amountText = `-${parseFloat(transaction.amount).toFixed(2)}`;
                    amountColor = 'text-red-400';
                    break;
                case 'Transfer In':
                    transactionTypeText = 'Transfer In';
                    amountText = `+${parseFloat(transaction.amount).toFixed(2)}`;
                    amountColor = 'text-green-400';
                    break;
                default:
                    transactionTypeText = transaction.type;
                    amountText = `${parseFloat(transaction.amount).toFixed(2)}`;
                    amountColor = 'text-blue-400';
                    break;
            }
            
            const status = transaction.status.toLowerCase();
            switch (status) {
                case 'pending':
                    statusColor = 'text-yellow-400';
                    break;
                case 'completed':
                case 'approved': // Handle 'Approved' from admin as 'Completed' on user side
                    statusColor = 'text-green-400';
                    break;
                case 'declined':
                    statusColor = 'text-red-400';
                    break;
                default:
                    statusColor = 'text-gray-400';
                    break;
            }
            
            newRow.innerHTML = `
                <td class="py-2 px-3">${date}</td>
                <td class="py-2 px-3">${transactionTypeText}</td>
                <td class="py-2 px-3 ${amountColor}">${amountText}</td>
                <td class="py-2 px-3 ${statusColor}">${transaction.status}</td>
            `;
            transactionHistoryTableBody.appendChild(newRow);
        }
    }

    // Function to setup real-time transaction listener
    function setupTransactionListener() {
        if (!currentUser) return;
        
        // Remove existing listener if any
        if (transactionListener) {
            off(ref(db, `artifacts/${appId}/public/data/transactions`), 'value', transactionListener);
            console.log("Unsubscribed from previous transaction listener.");
        }

        const transactionRef = ref(db, `artifacts/${appId}/public/data/transactions`);
        transactionListener = onValue(transactionRef, (snapshot) => {
            if (snapshot.exists()) {
                const transactions = snapshot.val();
                const userTransactions = [];
                
                // Filter transactions for current user - FIXED: Prevent duplicate transfer transactions
                Object.values(transactions).forEach(transaction => {
                    // For transfers, only show:
                    // - Transfer Out for the sender (userId matches currentUser.uid)
                    // - Transfer In for the recipient (recipientUid matches currentUser.uid, but userId should NOT match currentUser.uid)
                    if (transaction.type === 'Transfer Out' && transaction.userId === currentUser.uid) {
                        userTransactions.push(transaction);
                    } else if (transaction.type === 'Transfer In' && transaction.userId === currentUser.uid && transaction.senderUid !== currentUser.uid) {
                        userTransactions.push(transaction);
                    } else if (transaction.type !== 'Transfer Out' && transaction.type !== 'Transfer In' && transaction.userId === currentUser.uid) {
                        // For non-transfer transactions, show only if userId matches
                        userTransactions.push(transaction);
                    }
                });
                
                // Sort by creation date (newest first)
                userTransactions.sort((a, b) => (b.createdAt || 0) - (a.createdAt || 0));
                
                // Clear existing UI
                if (recentActivityList) recentActivityList.innerHTML = '';
                if (transactionHistoryTableBody) transactionHistoryTableBody.innerHTML = '';
                
                // Display transactions in recent activity (limit to 6)
                const recentTransactions = userTransactions.slice(0, 6);
                recentTransactions.forEach(transaction => {
                    displayTransactionInRecentActivity(transaction);
                });
                
                // Add "View More" link if there are more than 6 transactions
                if (userTransactions.length > 6 && recentActivityList) {
                    const viewMoreItem = document.createElement('li');
                    viewMoreItem.className = "text-center pt-2";
                    viewMoreItem.innerHTML = `
                        <button id="view-more-transactions" class="text-blue-400 hover:text-blue-300 text-sm underline">
                            View More (${userTransactions.length - 6} more)
                        </button>
                    `;
                    recentActivityList.appendChild(viewMoreItem);
                    
                    // Add click event to view more button
                    document.getElementById('view-more-transactions').addEventListener('click', () => {
                        showModal(transactionHistoryModal);
                    });
                }
                
                // Display all transactions in transaction history table
                userTransactions.forEach(transaction => {
                    displayTransactionInTable(transaction);
                });
                
                console.log("Real-time transactions updated:", userTransactions.length);
            } else {
                // Clear UI if no transactions
                if (recentActivityList) recentActivityList.innerHTML = '<li class="text-gray-400">No recent activity.</li>';
                if (transactionHistoryTableBody) transactionHistoryTableBody.innerHTML = '<tr><td colspan="4" class="py-2 px-3 text-center text-gray-400">No transaction history.</td></tr>';
                console.log("No transactions found - UI cleared");
            }
        }, (error) => {
            console.error("Error in transaction listener:", error);
            showMessageBox("Data Error", "Failed to load transaction data in real-time.");
        });
        console.log("Subscribed to new transaction listener.");
    }

    // Function to setup real-time balance listener
    function setupBalanceListener() {
        if (!currentUser) return;
        
        // Remove existing listener if any
        if (balanceListener) {
            off(ref(db, `artifacts/${appId}/users/${currentUser.uid}/profile/accountBalance`), 'value', balanceListener);
            console.log("Unsubscribed from previous balance listener.");
        }

        const balanceRef = ref(db, `artifacts/${appId}/users/${currentUser.uid}/profile/accountBalance`);
        balanceListener = onValue(balanceRef, (snapshot) => {
            const balance = snapshot.exists() ? snapshot.val() : 0;
            if (accountBalanceDisplay) {
                accountBalanceDisplay.textContent = parseFloat(balance).toFixed(2);
            }
            console.log("Real-time balance updated:", balance);
        }, (error) => {
            console.error("Error in balance listener:", error);
            showMessageBox("Data Error", "Failed to load balance data in real-time.");
        });
        console.log("Subscribed to new balance listener.");
    }

    // Function to setup user profile listener (to detect blocks and update UID display)
    function setupUserProfileListener() {
        if (!currentUser) return;

        // Remove existing listener if any
        if (userProfileListener) {
            off(ref(db, `artifacts/${appId}/users/${currentUser.uid}/profile`), 'value', userProfileListener);
            console.log("Unsubscribed from previous user profile listener.");
        }
        
        const userProfileRef = ref(db, `artifacts/${appId}/users/${currentUser.uid}/profile`);
        userProfileListener = onValue(userProfileRef, (snapshot) => {
            if (snapshot.exists()) {
                const userData = snapshot.val();
                window.currentUserData = userData; // Update global user data
                
                // Update UID display if admin changed it
                if (userUidDisplay && userData.customUid) {
                    userUidDisplay.textContent = userData.customUid;
                    console.log("UID display updated to custom UID:", userData.customUid);
                } else if (userUidDisplay) {
                    userUidDisplay.textContent = currentUser.uid;
                    console.log("UID display shows auth UID:", currentUser.uid);
                }
                
                // Check if user got blocked
                if (userData.isBlocked === true) {
                    showBlockedUserInterface();
                } else {
                    // If user was blocked but is now unblocked, hide the modal and restore dashboard
                    let blockedModalElement = document.getElementById('blocked-user-modal');
                    if (blockedModalElement && !blockedModalElement.classList.contains('hidden')) {
                        blockedModalElement.classList.add('hidden');
                        const dashboardContent = document.querySelector('.dashboard-content') || document.body;
                        if (dashboardContent) {
                            dashboardContent.style.display = ''; // Show content again
                        }
                    }
                }
                
                console.log("User profile updated:", userData);
            } else {
                // If profile disappears (e.g., user deleted by admin)
                console.warn("User profile no longer exists. Logging out.");
                signOut(auth);
            }
        }, (error) => {
            console.error("Error in user profile listener:", error);
            showMessageBox("Data Error", "Failed to load user profile data in real-time.");
        });
        console.log("Subscribed to new user profile listener.");
    }

    // Function to cleanup listeners
    function cleanupListeners() {
        if (transactionListener) {
            off(ref(db, `artifacts/${appId}/public/data/transactions`), 'value', transactionListener);
            transactionListener = null;
            console.log("Unsubscribed from public transactions listener.");
        }
        if (balanceListener) {
            off(ref(db, `artifacts/${appId}/users/${currentUser.uid}/profile/accountBalance`), 'value', balanceListener);
            balanceListener = null;
            console.log("Unsubscribed from user balance listener.");
        }
        if (userProfileListener) {
            off(ref(db, `artifacts/${appId}/users/${currentUser.uid}/profile`), 'value', userProfileListener);
            userProfileListener = null;
            console.log("Unsubscribed from user profile listener.");
        }
        console.log("Firebase listeners cleaned up");
    }

    // Function to get current balance
    async function getCurrentBalance() {
        try {
            const balanceRef = ref(db, `artifacts/${appId}/users/${currentUser.uid}/profile/accountBalance`);
            const snapshot = await get(balanceRef);
            return snapshot.exists() ? parseFloat(snapshot.val()) : 0;
        } catch (error) {
            console.error("Error getting current balance:", error);
            return 0;
        }
    }

    // Function to check if user has sufficient balance (for withdrawals/transfers)
    async function checkSufficientBalance(amount) {
        const currentBalance = await getCurrentBalance();
        return currentBalance >= amount;
    }


    // --- Main DOM Content Loaded Listener ---
    document.addEventListener('DOMContentLoaded', () => {
        console.log("DOM Content Loaded. Initializing UI elements and event listeners...");

        // Assign UI elements here to ensure they are available
        preloader = document.getElementById('preloader');
        sidebarToggleBtn = document.getElementById('sidebar-toggle-btn');
        sidebar = document.getElementById('sidebar');
        mobileSidebarOverlay = document.getElementById('mobile-sidebar-overlay');
        logoutBtn = document.getElementById('logout-btn');
        logoutConfirmModal = document.getElementById('logout-confirm-modal');
        confirmLogoutBtn = document.getElementById('confirm-logout-btn');
        cancelLogoutBtn = document.getElementById('cancel-logout-btn');
        placeTradeBtn = document.getElementById('place-trade-btn');
        placeTradeBtnMobile = document.getElementById('place-trade-btn-mobile');

        statementDropdownToggle = document.getElementById('statement-dropdown-toggle');
        statementDropdownMenu = document.getElementById('statement-dropdown-menu');
        accountDropdownToggle = document.getElementById('account-dropdown-toggle');
        accountDropdownMenu = document.getElementById('account-dropdown-menu');
        settingsDropdownToggle = document.getElementById('settings-dropdown-toggle');
        settingsDropdownMenu = document.getElementById('settings-dropdown-menu');

        welcomeModal = document.getElementById('welcome-modal');
        welcomeModalCloseBtn = document.getElementById('welcome-modal-close-btn');
        personalDataModal = document.getElementById('personal-data-modal');
        themeChangeModal = document.getElementById('theme-change-modal');
        accountFundingModal = document.getElementById('account-funding-modal');
        withdrawalModal = document.getElementById('withdrawal-modal');
        transferModal = document.getElementById('transfer-modal');
        transactionHistoryModal = document.getElementById('transaction-history-modal');
        tradingHistoryModal = document.getElementById('trading-history-modal');
        transferConfirmModal = document.getElementById('transfer-confirm-modal');

        dataFullName = document.getElementById('data-full-name');
        dataUsername = document.getElementById('data-username');
        dataEmail = document.getElementById('data-email');
        dataDob = document.getElementById('data-dob');
        dataCountry = document.getElementById('data-country');
        dataCity = document.getElementById('data-city');
        dataWorkplace = document.getElementById('data-workplace');
        dataPin = document.getElementById('data-pin');

        themeDarkBtn = document.getElementById('theme-dark');
        themeLightBtn = document.getElementById('theme-light');

        userUidDisplay = document.getElementById('user-uid-display');
        copyUidBtn = document.getElementById('copy-uid-btn');

        fundingForm = document.getElementById('funding-form');
        withdrawalForm = document.getElementById('withdrawal-form');
        transferForm = document.getElementById('transfer-form');

        transferRecipientUidInput = document.getElementById('transfer-recipient-uid');
        transferAmountInput = document.getElementById('transfer-amount');
        transferPinInput = document.getElementById('transfer-pin');

        transferConfirmMessage = document.getElementById('transfer-confirm-message');
        transferConfirmProceedBtn = document.getElementById('transfer-confirm-proceed-btn');
        transferConfirmCancelBtn = document.getElementById('transfer-confirm-cancel-btn');

        recentActivityList = document.getElementById('recent-activity-list');
        transactionHistoryTableBody = document.querySelector('#transaction-history-table tbody');

        // Assign message modal elements (CRITICAL FOR FIX)
        messageModal = document.getElementById('message-modal');
        messageModalTitle = document.getElementById('message-modal-title');
        messageModalText = document.getElementById('message-modal-text');
        messageModalCloseBtn = document.getElementById('message-modal-close-btn');

        accountBalanceDisplay = document.getElementById('account-balance');

        // Log status of critical elements after retrieval
        console.log("copyUidBtn:", copyUidBtn);
        console.log("transferForm:", transferForm);
        console.log("withdrawalForm:", withdrawalForm);
        console.log("messageModal:", messageModal);

        // --- Attach Event Listeners (now that elements are guaranteed) ---

        // General modal close button listener
        document.querySelectorAll('[data-close-modal]').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const modal = e.target.closest('.modal-overlay');
                if (modal) {
                    hideModal(modal);
                }
            });
        });

        // Hide modal when clicking outside of modal content
        document.querySelectorAll('.modal-overlay').forEach(overlay => {
            overlay.addEventListener('click', (e) => {
                // Ensure click is directly on the overlay, not on modal content
                if (e.target === overlay) {
                    hideModal(overlay);
                }
            });
        });

        // Message modal close button
        if (messageModalCloseBtn) {
            messageModalCloseBtn.addEventListener('click', hideMessageBox);
            console.log("Attached listener to messageModalCloseBtn.");
        }


        // Firebase Auth State Listener (placed here to ensure DOM is ready)
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                // Cleanup previous listeners if any
                cleanupListeners();
                
                currentUser = user;
                console.log("User logged in:", user.email || user.uid);
                
                // Check if user is blocked FIRST
                const isBlocked = await checkUserBlockStatus();
                if (isBlocked) {
                    return; // Stop further execution if user is blocked
                }
                
                // Fetch user data from Realtime Database to check for custom UID
                try {
                    const userProfileRef = ref(db, `artifacts/${appId}/users/${user.uid}/profile`);
                    const snapshot = await get(userProfileRef);
                    if (snapshot.exists()) {
                        const userData = snapshot.val();
                        console.log("User data fetched:", userData);
                        window.currentUserData = userData; // Store user data globally

                        // Set UID display - prioritize custom UID from admin
                        if (userUidDisplay) {
                            const displayUid = userData.customUid || user.uid;
                            userUidDisplay.textContent = displayUid;
                            console.log("User UID set to:", displayUid);
                        }

                        // Show welcome message only once per session
                        if (!sessionStorage.getItem('thrushGainsWelcomeShown')) {
                            showModal(welcomeModal);
                            sessionStorage.setItem('thrushGainsWelcomeShown', 'true');
                        }

                    } else {
                        console.log("No profile data found for user. Initializing default profile.");
                        window.currentUserData = {}; // Initialize as empty object
                        
                        if (userUidDisplay) {
                            userUidDisplay.textContent = user.uid; // Use auth UID for new users
                            console.log("User UID set to auth UID:", user.uid);
                        }
                        
                        // Set default profile data for new users
                        await set(userProfileRef, {
                            fullName: 'New User',
                            username: `user_${user.uid.substring(0, 6)}`,
                            email: user.email || 'N/A',
                            accountBalance: 0.00,
                            transactionPin: '1234', // Default PIN for new users
                            dateOfBirth: 'N/A',
                            country: 'N/A',
                            city: 'N/A',
                            workplace: 'N/A',
                            isBlocked: false
                        });

                        // Still show welcome for new accounts
                        if (!sessionStorage.getItem('thrushGainsWelcomeShown')) {
                            showModal(welcomeModal);
                            sessionStorage.setItem('thrushGainsWelcomeShown', 'true');
                        }
                    }

                    // Load user balance and transactions from Firebase
                    await loadUserBalance(); // Initial load
                    // await loadTransactionsFromFirebase(); // Initial load handled by listener now
                    
                    // Setup real-time listeners for continuous updates
                    setupTransactionListener();
                    setupBalanceListener();
                    setupUserProfileListener(); // Add profile listener to detect blocks and update personal data and UID
                    
                } catch (error) {
                    console.error("Error fetching user data or setting up listeners:", error);
                    showMessageBox("Error", "Failed to load user data or connect to real-time updates. Please try again.");
                }

                if (preloader) preloader.classList.add('preloader-hidden');
            } else {
                console.log("No user logged in, redirecting to login.html");
                cleanupListeners(); // Cleanup listeners when user logs out
                window.location.href = 'login.html';
            }
        });

        // --- Rest of the Event Listeners ---

        // Logout Functionality
        if (logoutBtn) {
            logoutBtn.addEventListener('click', () => {
                console.log("Logout button clicked. Showing logout confirm modal.");
                showModal(logoutConfirmModal);
            });
        }

        if (confirmLogoutBtn) {
            confirmLogoutBtn.addEventListener('click', async () => {
                console.log("Confirm logout button clicked.");
                try {
                    cleanupListeners(); // Cleanup listeners before logout
                    await signOut(auth);
                    sessionStorage.removeItem('thrushGainsWelcomeShown');
                    console.log("User signed out successfully.");
                }
                catch (error) {
                    console.error("Logout failed:", error);
                    showMessageBox("Logout Error", `Failed to sign out: ${error.message}`);
                } finally {
                    hideModal(logoutConfirmModal);
                }
            });
        }

        if (cancelLogoutBtn) {
            cancelLogoutBtn.addEventListener('click', () => {
                console.log("Cancel logout button clicked.");
                hideModal(logoutConfirmModal);
            });
        }

        // Sidebar Toggle Functions
        function openSidebar() {
            if (sidebar) {
                sidebar.classList.remove("sidebar-closed");
                sidebar.classList.add("sidebar-open");
            }
            if (mobileSidebarOverlay) {
                mobileSidebarOverlay.classList.remove("hidden");
            }
        }

        function closeSidebar() {
            if (sidebar) {
                sidebar.classList.remove("sidebar-open");
                sidebar.classList.add("sidebar-closed");
            }
            if (mobileSidebarOverlay) {
                mobileSidebarOverlay.classList.add("hidden");
            }
        }

        // Sidebar Toggle Event Listeners
        if (sidebarToggleBtn) {
            sidebarToggleBtn.addEventListener("click", () => {
                if (sidebar && sidebar.classList.contains("sidebar-open")) {
                    closeSidebar();
                } else {
                    openSidebar();
                }
            });
        }

        if (mobileSidebarOverlay) {
            mobileSidebarOverlay.addEventListener("click", () => {
                closeSidebar();
            });
        }


        // Close sidebar when a dropdown item is clicked (on mobile)
        document.querySelectorAll('.dropdown-item').forEach(item => {
            item.addEventListener('click', () => {
                console.log("Dropdown item clicked.");
                if (window.innerWidth < 768) {
                    closeSidebar(); // Use the new closeSidebar function
                }
            });
        });

        // Dropdown Toggles
        if (statementDropdownToggle) {
            statementDropdownToggle.addEventListener('click', () => {
                console.log("Statement dropdown toggled.");
                toggleDropdown(statementDropdownToggle, statementDropdownMenu);
            });
        }
        if (accountDropdownToggle) {
            accountDropdownToggle.addEventListener('click', () => {
                console.log("Account dropdown toggled.");
                toggleDropdown(accountDropdownToggle, accountDropdownMenu);
            });
        }
        if (settingsDropdownToggle) {
            settingsDropdownToggle.addEventListener('click', () => {
                console.log("Settings dropdown toggled.");
                toggleDropdown(settingsDropdownToggle, settingsDropdownMenu);
            });
        }


        // Generic modal opening handler for sidebar dropdown items
        document.querySelectorAll('[data-modal-target]').forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault(); // Crucial to prevent default link behavior/page reload
                const modalId = e.target.closest('[data-modal-target]').dataset.modalTarget;
                const modal = document.getElementById(modalId);
                console.log(`Attempting to open modal: ${modalId}`);
                if (modal) {
                    showModal(modal);
                    if (modalId === 'personal-data-modal' && window.currentUserData) {
                        if (dataFullName) dataFullName.textContent = window.currentUserData.fullName || 'N/A';
                        if (dataUsername) dataUsername.textContent = window.currentUserData.username || 'N/A';
                        if (dataEmail) dataEmail.textContent = window.currentUserData.email || 'N/A';
                        if (dataDob) dataDob.textContent = window.currentUserData.dateOfBirth || 'N/A';
                        if (dataCountry) dataCountry.textContent = window.currentUserData.country || 'N/A';
                        if (dataCity) dataCity.textContent = window.currentUserData.city || 'N/A';
                        if (dataWorkplace) dataWorkplace.textContent = window.currentUserData.workplace || 'N/A';
                        // Ensure pin is always masked
                        if (dataPin) dataPin.textContent = (window.currentUserData.transactionPin && window.currentUserData.transactionPin.length === 4) ? '****' : 'N/A';
                        console.log("Personal data populated.");
                    }
                } else {
                    console.error(`Modal with ID "${modalId}" not found.`);
                }
            });
        });

        // Close Welcome Modal
        if (welcomeModalCloseBtn) {
            welcomeModalCloseBtn.addEventListener('click', () => {
                console.log("Welcome modal close button clicked.");
                hideModal(welcomeModal);
            });
        }


        // Theme Change Logic
        if (themeDarkBtn) {
            themeDarkBtn.addEventListener('click', () => {
                console.log("Dark theme button clicked.");
                document.body.classList.remove('light-theme');
                localStorage.setItem('theme', 'dark');
                hideModal(themeChangeModal);
            });
        }
        if (themeLightBtn) {
            themeLightBtn.addEventListener('click', () => {
                console.log("Light theme button clicked.");
                document.body.classList.add('light-theme');
                localStorage.setItem('theme', 'light');
                hideModal(themeChangeModal);
            });
        }
        applySavedTheme(); // Apply theme immediately on load

        // Place Trade Button Logic
        function handlePlaceTradeClick() {
            console.log("Place Trade button clicked.");
            showMessageBox(
                "Place Trade",
                "To place a trade, please contact our customer support via the chat icon for assistance."
            );
            if (window.innerWidth < 768) {
                closeSidebar(); // Use the new closeSidebar function
            }
        }
        if (placeTradeBtn) placeTradeBtn.addEventListener('click', handlePlaceTradeClick);
        if (placeTradeBtnMobile) placeTradeBtnMobile.addEventListener('click', handlePlaceTradeClick);

        // Copy UID Button Logic
        if (copyUidBtn) {
            console.log("Attached click listener to copyUidBtn.");
            copyUidBtn.addEventListener('click', () => {
                console.log("Copy UID button clicked.");
                const uid = userUidDisplay.textContent;
                if (uid && uid !== 'N/A') {
                    try {
                        const tempInput = document.createElement('textarea');
                        tempInput.value = uid;
                        document.body.appendChild(tempInput);
                        tempInput.select();
                        document.execCommand('copy'); // Using execCommand for broader iframe compatibility
                        document.body.removeChild(tempInput);
                        showMessageBox("Copied!", "Your User ID has been copied to clipboard.");
                        console.log("User ID copied successfully.");
                    } catch (err) {
                        console.error('Failed to copy UID:', err);
                        showMessageBox("Copy Failed", "Could not copy User ID. Please try manually.");
                    }
                } else {
                    showMessageBox("Copy Failed", "User ID not available to copy.");
                    console.warn("Attempted to copy UID, but userUidDisplay was 'N/A' or empty.");
                }
            });
        }

        // Account Funding Form Submission Handler
        if (fundingForm) {
            console.log("Attached submit listener to fundingForm.");
            fundingForm.addEventListener('submit', async (e) => {
                e.preventDefault(); // Prevent page reload
                console.log("Funding form submitted. Preventing default behavior.");

                const amount = parseFloat(fundingForm['funding-amount'].value); // Parse to float
                const method = fundingForm['funding-method'].value;

                if (isNaN(amount) || amount <= 0 || !method) {
                    showMessageBox("Input Error", "Please enter a valid positive amount and select a method for funding.");
                    return;
                }

                try {
                    // Save transaction to Firebase
                    const transactionData = {
                        type: 'deposit',
                        amount: amount,
                        method: method,
                        description: `Deposit via ${method}`
                    };

                    await saveTransactionToFirebase(transactionData);
                    
                    showMessageBox("Funding Request", `Your request to fund ${amount.toFixed(2)} via ${method} has been submitted for review. Pending admin approval. Please chat admin for approval.`);
                    
                    hideModal(accountFundingModal);
                    fundingForm.reset();
                    console.log("Funding request saved to Firebase successfully.");
                    
                } catch (error) {
                    console.error("Error saving funding request:", error);
                    showMessageBox("Error", "Failed to submit funding request. Please try again.");
                }
            });
        }

        // Withdrawal Form Submission Handler
        if (withdrawalForm) {
            console.log("Attached submit listener to withdrawalForm.");
            withdrawalForm.addEventListener('submit', async (e) => {
                e.preventDefault(); // Prevent page reload
                console.log("Withdrawal form submitted. Preventing default behavior.");

                const amount = parseFloat(withdrawalForm['withdrawal-amount'].value); // Parse to float
                const method = withdrawalForm['withdrawal-method'].value;
                const address = withdrawalForm['withdrawal-address'].value;

                if (isNaN(amount) || amount <= 0 || !method || !address) {
                    showMessageBox("Input Error", "Please fill in all withdrawal details and ensure amount is positive.");
                    return;
                }

                try {
                    // Check sufficient balance
                    const hasSufficientBalance = await checkSufficientBalance(amount);
                    if (!hasSufficientBalance) {
                        const currentBalance = await getCurrentBalance();
                        showMessageBox("Insufficient Funds", `You do not have sufficient funds for this withdrawal. Your balance is ${currentBalance.toFixed(2)}.`);
                        return;
                    }

                    // Save transaction to Firebase
                    const transactionData = {
                        type: 'withdrawal',
                        amount: amount,
                        method: method,
                        address: address,
                        description: `Withdrawal to ${method}`
                    };

                    await saveTransactionToFirebase(transactionData);
                    
                    showMessageBox("Withdrawal Request", `Your request to withdraw ${amount.toFixed(2)} to your ${method} has been submitted for approval. Pending admin approval. Please chat admin for approval.`);
                    
                    hideModal(withdrawalModal);
                    withdrawalForm.reset();
                    console.log("Withdrawal request saved to Firebase successfully.");
                    
                } catch (error) {
                    console.error("Error saving withdrawal request:", error);
                    showMessageBox("Error", "Failed to submit withdrawal request. Please try again.");
                }
            });
        }

        // Transfer Funds Logic
        if (transferForm) {
            console.log("Attached submit listener to transferForm.");
            transferForm.addEventListener('submit', async (e) => {
                e.preventDefault(); // Prevent page reload
                console.log("Transfer form submitted. Preventing default behavior.");

                const recipientUid = transferRecipientUidInput.value.trim();
                const transferAmount = parseFloat(transferAmountInput.value);
                const transferPin = transferPinInput.value;

                // Basic validation
                if (!recipientUid || isNaN(transferAmount) || transferAmount <= 0 || !transferPin || transferPin.length !== 4) {
                    showMessageBox("Input Error", "Please fill all fields correctly. Amount must be positive and PIN 4 digits.");
                    return;
                }

                // Check for sufficient funds
                try {
                    const hasSufficientBalance = await checkSufficientBalance(transferAmount);
                    if (!hasSufficientBalance) {
                        const currentBalance = await getCurrentBalance();
                        showMessageBox("Insufficient Funds", `You do not have sufficient funds for this transfer. Your balance is ${currentBalance.toFixed(2)}.`);
                        return;
                    }
                } catch (error) {
                    console.error("Error checking balance:", error);
                    showMessageBox("Error", "Failed to verify balance. Please try again.");
                    return;
                }

                // Client-side PIN validation (compare with stored PIN)
                if (!window.currentUserData || !window.currentUserData.transactionPin) {
                    showMessageBox("Error", "Your Transaction PIN is not available. Please ensure you are logged in correctly and contact support if this persists.");
                    console.error("currentUserData or transactionPin missing.");
                    return;
                }
                if (transferPin !== window.currentUserData.transactionPin) {
                     showMessageBox("Error", "Invalid Transaction PIN.");
                     console.log("Invalid transaction PIN entered.");
                     return;
                }

                // REMOVED: Check if recipient exists - now allows any UID

                transferConfirmMessage.innerHTML = `Are you sure you want to transfer <strong>${transferAmount.toFixed(2)}</strong> to User ID: <strong>${recipientUid.substring(0, 8)}...</strong>?`;
                hideModal(transferModal);
                showModal(transferConfirmModal);
                console.log("Transfer confirmation modal shown.");
            });
        }

        if (transferConfirmProceedBtn) {
            console.log("Attached click listener to transferConfirmProceedBtn.");
            transferConfirmProceedBtn.addEventListener('click', async () => {
                console.log("Transfer confirmation proceed button clicked.");
                hideModal(transferConfirmModal);

                const recipientUid = transferRecipientUidInput.value.trim();
                const transferAmount = parseFloat(transferAmountInput.value);

                try {
                    // Save outgoing transfer transaction to public transactions
                    const senderTransactionData = {
                        type: 'transfer_out',
                        amount: transferAmount,
                        recipientUid: recipientUid,
                        description: `Transfer to ${recipientUid.substring(0, 8)}...`
                    };

                    await saveTransactionToFirebase(senderTransactionData);

                    // Save incoming transfer transaction to public transactions for recipient
                    const publicTransactionRef = ref(db, `artifacts/${appId}/public/data/transactions`);
                    const newRecipientTransactionRef = push(publicTransactionRef);
                    const recipientTransactionData = {
                        id: newRecipientTransactionRef.key,
                        userId: recipientUid, // This is the recipient's UID
                        type: 'Transfer In',
                        amount: transferAmount,
                        senderUid: currentUser.uid, // This is the sender's UID
                        status: 'Pending',
                        description: `Transfer from ${currentUser.uid.substring(0, 8)}...`,
                        date: new Date().toISOString().slice(0, 10),
                        createdAt: Date.now(),
                        updatedAt: Date.now()
                    };
                    
                    await set(newRecipientTransactionRef, recipientTransactionData);

                    showMessageBox("Transfer Initiated", `Transfer submitted successfully! Pending admin approval. Please chat admin for approval.`);
                    console.log("Transfer transactions saved to Firebase successfully.");

                    // Clear the transfer form fields after submission
                    transferForm.reset();
                    console.log("Transfer form reset.");
                    
                } catch (error) {
                    console.error("Error saving transfer:", error);
                    showMessageBox("Error", "Failed to initiate transfer. Please try again.");
                }
            });
        }

        if (transferConfirmCancelBtn) {
            console.log("Attached click listener to transferConfirmCancelBtn.");
            transferConfirmCancelBtn.addEventListener('click', () => {
                console.log("Transfer confirmation cancel button clicked.");
                hideModal(transferConfirmModal);
                showModal(transferModal); // Re-open transfer form if user cancels
            });
        }

        // Preloader hiding on window load
        window.addEventListener('load', () => {
            if (preloader) preloader.classList.add('preloader-hidden');
            console.log("Window loaded, preloader hidden.");
        });
    });

    // --- Admin Functions (keep for compatibility) ---
    // These functions are not used in user dashboard but kept for compatibility

    // Function to approve a transaction
    window.approveTransaction = async function(userId, transactionId) {
        console.log("approveTransaction called - this function is for admin use only");
        return { success: false, message: "Admin function called from user dashboard" };
    };

    // Function to decline a transaction
    window.declineTransaction = async function(userId, transactionId, reason = '') {
        console.log("declineTransaction called - this function is for admin use only");
        return { success: false, message: "Admin function called from user dashboard" };
    };

    // Function for admin to fund user account
    window.adminFundUser = async function(userId, amount, description = 'Admin funding') {
        console.log("adminFundUser called - this function is for admin use only");
        return { success: false, message: "Admin function called from user dashboard" };
    };

    // Function to get all pending transactions (for admin panel)
    window.getAllPendingTransactions = async function() {
        console.log("getAllPendingTransactions called - this function is for admin use only");
        return [];
    };
</script>
<!--Start of Tawk.to Script-->
<script type="text/javascript">
var Tawk_API=Tawk_API||{}, Tawk_LoadStart=new Date();
(function(){
var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
s1.async=true;
s1.src='https://embed.tawk.to/68a44b7e0f9cc91929d548ba/1j30sdqct';
s1.charset='UTF-8';
s1.setAttribute('crossorigin','*');
s0.parentNode.insertBefore(s1,s0);
})();
</script>
<!--End of Tawk.to Script-->
</body>
</html>
